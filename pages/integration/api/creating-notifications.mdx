# Creating notifications

These section describes how you can create notifications. Notifir provides REST and GraphQL APIs. The new notifications appear in the notification inbox of the recipient in real-time.

---

All requests require following headers:

| Header&emsp;&emsp;&emsp; | Description                                                                   |
| ------------------------ | ----------------------------------------------------------------------------- |
| x-api-key                | containing project's API key                                                  |
| x-user-id                | containing the id of the user performing the request                          |
| x-user-hmac              | (if hmac authentication is enabled) containing the computed hash for the user |

## REST API

**POST** `/api/notifications`

Example usage:

```
curl --request POST \
     --url https://t-notifications-api.herokuapp.com/api/notifications \
     --header 'Content-Type: application/json' \
     --header 'x-api-key: [api_key]' \
     --header 'x-user-id: [user_id]' \
     --header 'x-user-hmac: [user_id_hmac]' \
     --data '
       {
         "type": "entry-created",
         "recipients": ["beast~mailinator.com@marvel-x-men"],
         "payload": {
            "entry": "001",
            "step": "New",
            "folder": "Reports",
            "user": "Henry McCoy"
         },
         "action_url": "https://notifir.github.io/widget"
       }'
```

##### Body params

| Parameter   | Description                                                         | Type   | Required | Notes           |
| ----------- | ------------------------------------------------------------------- | ------ | :------: | --------------- |
| type        | type of the notification                                            | String |    ✅    | Max length: 255 |
| recipients  | list of user ids to send the notification to                        | Array  |    ✅    | Min items: 1    |
| payload     | custom map of data that is used to generate messages from templates | Object |          |                 |
| action_url  | url to redirect the user to when they click the notification        | String |          |                 |

##### Responses

**201**

```json
{
  "notifications": [
    {
      "id": "6bf116d6-08f5-11ed-ad74-7b8c7a2131e1"
    }
  ]
}
```

**400**

```json
{
  "error": "bad_request",
  "message": "Field 'type' is required and cannot be empty."
}
```

**401**

```json
{
  "error": "unauthorized",
  "message": "Missing required header 'x-user-hmac'"
}
```

**403**

```json
{
  "error": "forbidden",
  "message": "User beast~mailinator.com@marvel-x-men doesn't have permission to create notifications"
}
```

**500**

```json
{
  "error": "internal_server_error",
  "message": "An error occurred while creating new notification: No data returned from the query."
}
```

## GraphQL API

**POST** `/api/graphql`

Example usage:

```
curl --request POST \
     --url https://t-notifications-api.herokuapp.com/api/graphql \
     --header 'Content-Type: application/json' \
     --header 'x-api-key: [api_key]' \
     --header 'x-user-id: [user_id]' \
     --header 'x-user-hmac: [user_id_hmac]' \
     --data '
       {
         "query": "mutation { createNotification(input: { notification: { type: \"entry-created\", userId: \"beast~mailinator.com@marvel-x-men\", projectId: \"default\", payload: \"{\\\"entry\\\": \\\"001\\\", \\\"step\\\": \\\"New\\\", \\\"folder\\\": \\\"Reports\\\", \\\"user\\\": \\\"Henry McCoy\\\" }\" } } ) { notification { id } } }"
       }'

```

##### Responses

**200**

```json
{
  "data": {
    "createNotification": {
      "notification": {
        "id": "71e4f80a-0909-11ed-9a68-e765b0b955a1"
      }
    }
  }
}
```

**400**

```json
{
  "errors": [
    {
      "locations": [
        {
          "column": 55,
          "line": 1
        }
      ],
      "message": "Field \"NotificationInput.type\" of required type \"String!\" was not provided."
    }
  ]
}
```

**500**

```json
{
  "errors": [
    {
      "message": "Missing required header 'x-user-id'"
    }
  ]
}
```
